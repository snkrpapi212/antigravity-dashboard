<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Antigravity Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script crossorigin src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
  <script crossorigin src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: {
            bg: '#0f172a',
            panel: '#111827',
            panel2: '#1f2937',
            borderc: '#334155',
            primary: '#6366f1',
            success: '#22c55e',
            danger: '#f43f5e',
            warn: '#f59e0b'
          },
          boxShadow: {
            glow: '0 0 0 1px rgba(99,102,241,.18), 0 12px 30px -16px rgba(99,102,241,.55)'
          }
        }
      }
    }
  </script>

  <style>
    body { font-family: Inter, system-ui, sans-serif; background: #0b1220; }
    .glass { background: rgba(17, 24, 39, .72); backdrop-filter: blur(8px); border: 1px solid rgba(148,163,184,.15); }
    .card { background: linear-gradient(180deg, rgba(30,41,59,.76), rgba(15,23,42,.84)); border: 1px solid rgba(148,163,184,.13); }
    .fade-up { animation: fadeUp .45s ease-out both; }
    @keyframes fadeUp { from { opacity:0; transform: translateY(8px);} to {opacity:1; transform: translateY(0);} }
    .spark path { fill: none; stroke-width: 2.2; }
  </style>
</head>
<body class="text-slate-100 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useState } = React;
    const {
      ResponsiveContainer,
      LineChart, Line,
      BarChart, Bar,
      XAxis, YAxis, CartesianGrid, Tooltip,
      Legend
    } = window.Recharts || {};

    const formatCurrency = (n) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n);
    const formatCompact = (n) => new Intl.NumberFormat('en-US', { notation: 'compact', maximumFractionDigits: 1 }).format(n);
    const formatPct = (n) => `${n > 0 ? '+' : ''}${n.toFixed(1)}%`;

    const days = Array.from({ length: 120 }, (_, i) => {
      const d = new Date();
      d.setDate(d.getDate() - (119 - i));
      const t = i + 1;
      const seasonal = Math.sin(t / 8) * 1200;
      const trend = t * 38;
      const noise = (Math.random() - 0.5) * 1300;
      const revenue = Math.max(3800, 12000 + trend + seasonal + noise);
      const users = Math.max(300, 900 + t * 3 + Math.sin(t / 5) * 80 + (Math.random() - 0.5) * 60);
      const conversion = Math.max(1.6, Math.min(7.8, 3.2 + Math.sin(t / 9) * 0.7 + (Math.random() - 0.5) * 0.35));
      return {
        date: d,
        label: d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
        revenue: Math.round(revenue),
        users: Math.round(users),
        conversion: Number(conversion.toFixed(2))
      };
    });

    const categoryMultiplier = {
      All: 1,
      Enterprise: 1.3,
      SMB: 1.05,
      Consumer: 0.86
    };

    function MiniSpark({ data, color = '#818cf8' }) {
      const w = 120, h = 34;
      const min = Math.min(...data), max = Math.max(...data);
      const range = max - min || 1;
      const points = data.map((v, i) => {
        const x = (i / (data.length - 1)) * w;
        const y = h - ((v - min) / range) * h;
        return `${x},${y}`;
      }).join(' ');
      return (
        <svg className="spark" width={w} height={h} viewBox={`0 0 ${w} ${h}`}>
          <path d={`M ${points.replace(/ /g, ' L ')}`} stroke={color} />
        </svg>
      );
    }

    function KpiCard({ title, value, delta, spark, icon, tone = 'text-primary', delay = 0 }) {
      const up = delta >= 0;
      return (
        <div className="card rounded-2xl p-5 shadow-glow hover:-translate-y-0.5 transition-all duration-300 fade-up" style={{ animationDelay: `${delay}ms` }}>
          <div className="flex items-start justify-between mb-3">
            <div className="text-slate-400 text-sm font-medium">{title}</div>
            <div className={`text-xs px-2 py-1 rounded-full ${up ? 'bg-emerald-500/15 text-emerald-300' : 'bg-rose-500/15 text-rose-300'}`}>
              {up ? '▲' : '▼'} {Math.abs(delta).toFixed(1)}%
            </div>
          </div>
          <div className={`text-3xl font-extrabold tracking-tight ${tone}`}>{value}</div>
          <div className="mt-3 flex items-end justify-between">
            <MiniSpark data={spark} color={up ? '#22c55e' : '#f43f5e'} />
            <div className="text-slate-500 text-xs">{icon}</div>
          </div>
        </div>
      );
    }

    function App() {
      const [range, setRange] = useState('30');
      const [category, setCategory] = useState('All');

      const filtered = useMemo(() => {
        const daysBack = range === 'all' ? 120 : Number(range);
        const slice = days.slice(-daysBack);
        const m = categoryMultiplier[category] || 1;
        return slice.map(r => ({
          ...r,
          revenue: Math.round(r.revenue * m),
          users: Math.round(r.users * (0.9 + m * 0.12)),
          conversion: Number(Math.min(9.9, r.conversion * (0.93 + m * 0.08)).toFixed(2))
        }));
      }, [range, category]);

      const previousWindow = useMemo(() => {
        const daysBack = range === 'all' ? 120 : Number(range);
        return days.slice(-(daysBack * 2), -daysBack);
      }, [range]);

      const agg = useMemo(() => {
        const sumRevenue = filtered.reduce((a,b)=>a+b.revenue,0);
        const sumUsers = filtered.reduce((a,b)=>a+b.users,0);
        const avgConv = filtered.reduce((a,b)=>a+b.conversion,0) / filtered.length;
        const growth = ((filtered[filtered.length-1].revenue - filtered[0].revenue) / filtered[0].revenue) * 100;

        const prevRevenue = previousWindow.reduce((a,b)=>a+b.revenue,0) || 1;
        const prevUsers = previousWindow.reduce((a,b)=>a+b.users,0) || 1;
        const prevConv = previousWindow.length ? previousWindow.reduce((a,b)=>a+b.conversion,0) / previousWindow.length : 1;
        const prevGrowth = previousWindow.length > 1 ? ((previousWindow[previousWindow.length-1].revenue - previousWindow[0].revenue) / previousWindow[0].revenue) * 100 : growth;

        return {
          revenue: { value: sumRevenue, delta: ((sumRevenue - prevRevenue) / prevRevenue) * 100, spark: filtered.slice(-18).map(x=>x.revenue) },
          users: { value: sumUsers, delta: ((sumUsers - prevUsers) / prevUsers) * 100, spark: filtered.slice(-18).map(x=>x.users) },
          conversion: { value: avgConv, delta: ((avgConv - prevConv) / prevConv) * 100, spark: filtered.slice(-18).map(x=>x.conversion) },
          growth: { value: growth, delta: growth - prevGrowth, spark: filtered.slice(-18).map((x, i, arr)=> i===0 ? 0 : ((x.revenue-arr[i-1].revenue)/arr[i-1].revenue)*100) }
        }
      }, [filtered, previousWindow]);

      const bars = useMemo(() => {
        const chunks = [];
        const size = Math.max(3, Math.floor(filtered.length / 8));
        for (let i=0; i<filtered.length; i+=size) {
          const block = filtered.slice(i, i+size);
          const label = block[Math.floor(block.length/2)]?.label || '';
          chunks.push({
            label,
            users: Math.round(block.reduce((a,b)=>a+b.users,0) / block.length),
            conversion: Number((block.reduce((a,b)=>a+b.conversion,0) / block.length).toFixed(2))
          });
        }
        return chunks;
      }, [filtered]);

      if (!window.Recharts || !LineChart) {
        return <div className="min-h-screen grid place-items-center p-6 text-center text-slate-300">Unable to load chart libraries. Run with internet access and open via local server.</div>;
      }

      return (
        <div className="max-w-7xl mx-auto p-5 md:p-8 space-y-6">
          <header className="glass rounded-2xl p-5 md:p-6 fade-up">
            <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
              <div>
                <h1 className="text-3xl md:text-4xl font-extrabold tracking-tight">Antigravity Dashboard</h1>
                <p className="text-slate-400 mt-1">Executive metrics, trends, and conversion performance.</p>
              </div>

              <div className="flex flex-wrap items-center gap-3">
                <div className="glass rounded-xl px-3 py-2">
                  <label className="text-xs text-slate-400 mr-2">Date Range</label>
                  <select value={range} onChange={(e)=>setRange(e.target.value)} className="bg-transparent text-sm outline-none">
                    <option value="7" className="text-black">Last 7 days</option>
                    <option value="30" className="text-black">Last 30 days</option>
                    <option value="90" className="text-black">Last 90 days</option>
                    <option value="all" className="text-black">All data</option>
                  </select>
                </div>

                <div className="glass rounded-xl px-3 py-2">
                  <label className="text-xs text-slate-400 mr-2">Category</label>
                  <select value={category} onChange={(e)=>setCategory(e.target.value)} className="bg-transparent text-sm outline-none">
                    <option value="All" className="text-black">All</option>
                    <option value="Enterprise" className="text-black">Enterprise</option>
                    <option value="SMB" className="text-black">SMB</option>
                    <option value="Consumer" className="text-black">Consumer</option>
                  </select>
                </div>
              </div>
            </div>
          </header>

          <section className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-5">
            <KpiCard title="Revenue" value={formatCurrency(agg.revenue.value)} delta={agg.revenue.delta} spark={agg.revenue.spark} icon="Revenue" tone="text-indigo-300" delay={60} />
            <KpiCard title="Users" value={formatCompact(agg.users.value)} delta={agg.users.delta} spark={agg.users.spark} icon="Users" tone="text-cyan-300" delay={110} />
            <KpiCard title="Conversion" value={`${agg.conversion.value.toFixed(2)}%`} delta={agg.conversion.delta} spark={agg.conversion.spark} icon="CVR" tone="text-emerald-300" delay={160} />
            <KpiCard title="Growth" value={formatPct(agg.growth.value)} delta={agg.growth.delta} spark={agg.growth.spark} icon="Growth" tone="text-amber-300" delay={210} />
          </section>

          <section className="grid grid-cols-1 xl:grid-cols-2 gap-5">
            <div className="card rounded-2xl p-5 md:p-6 fade-up" style={{ animationDelay: '250ms' }}>
              <h2 className="text-lg font-semibold mb-4">Revenue Trend (Line)</h2>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={filtered}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis dataKey="label" tick={{ fill: '#94a3b8', fontSize: 11 }} minTickGap={24} />
                    <YAxis tick={{ fill: '#94a3b8', fontSize: 11 }} tickFormatter={(v)=>`$${Math.round(v/1000)}k`} />
                    <Tooltip contentStyle={{ background: '#0f172a', border: '1px solid #334155', borderRadius: '10px' }} formatter={(v)=>formatCurrency(v)} />
                    <Line type="monotone" dataKey="revenue" stroke="#818cf8" strokeWidth={3} dot={false} activeDot={{ r: 5 }} />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="card rounded-2xl p-5 md:p-6 fade-up" style={{ animationDelay: '300ms' }}>
              <h2 className="text-lg font-semibold mb-4">Users vs Conversion (Bar)</h2>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={bars}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis dataKey="label" tick={{ fill: '#94a3b8', fontSize: 11 }} />
                    <YAxis yAxisId="left" tick={{ fill: '#94a3b8', fontSize: 11 }} />
                    <YAxis yAxisId="right" orientation="right" tick={{ fill: '#94a3b8', fontSize: 11 }} tickFormatter={(v)=>`${v}%`} />
                    <Tooltip contentStyle={{ background: '#0f172a', border: '1px solid #334155', borderRadius: '10px' }} />
                    <Legend wrapperStyle={{ color: '#cbd5e1' }} />
                    <Bar yAxisId="left" dataKey="users" fill="#60a5fa" radius={[8,8,0,0]} />
                    <Bar yAxisId="right" dataKey="conversion" fill="#f472b6" radius={[8,8,0,0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </div>
          </section>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
